<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Giftup Final Solo</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --blue: #007aff; --green: #34c759; --red: #ff3b30; }
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; padding: 0; overflow: hidden; }
        
        .header { padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #1a1a1a; }
        .balance { background: var(--green); color: #000; padding: 5px 12px; border-radius: 20px; font-weight: bold; }

        .screen { display: none; height: calc(100vh - 50px); flex-direction: column; }
        .active { display: flex; }

        /* –Ü–°–¢–û–†–Ü–Ø –Ü–ö–°–Ü–í (–ó–í–ï–†–•–£) */
        .history { padding: 8px 10px; display: flex; gap: 8px; overflow-x: auto; border-bottom: 1px solid #1a1a1a; scrollbar-width: none; }
        .hs-item { background: #111; padding: 5px 12px; border-radius: 6px; font-size: 12px; border: 1px solid #222; min-width: 45px; text-align: center; }

        /* –ó–û–ù–ê –†–ê–ö–ï–¢–ò - –ß–ò–°–¢–ò–ô –ß–û–†–ù–ò–ô */
        .viewport { flex-grow: 1; display: flex; align-items: center; justify-content: center; background: #000; position: relative; }
        #rocket { width: 260px; mix-blend-mode: screen; transform: scale(0); transition: 0.3s; }

        /* –ö–ï–†–£–í–ê–ù–ù–Ø */
        .controls { padding: 15px; border-top: 1px solid #1a1a1a; }
        input { width: 100%; background: #111; border: 1px solid #222; padding: 12px; color: #fff; border-radius: 10px; text-align: center; margin-bottom: 10px; box-sizing: border-box; font-size: 16px; }
        .btn { width: 100%; padding: 18px; border-radius: 12px; border: none; font-size: 17px; font-weight: bold; color: #fff; cursor: pointer; }

        /* –°–ü–ò–°–û–ö –°–¢–ê–í–û–ö (–ì–û–†–¢–ê–Ñ–¢–¨–°–Ø) */
        .bets-list { height: 120px; overflow-y: auto; padding: 10px 15px; border-top: 1px solid #1a1a1a; }
        .bet-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 14px; }
        .u-info { display: flex; align-items: center; gap: 8px; }
        .u-img { width: 26px; height: 26px; border-radius: 50%; background: #222; }
    </style>
</head>
<body>

    <div class="header">
        <div style="font-weight: bold;">GIFTUP</div>
        <div class="balance"><span id="bal-val">500.00</span> ‚Ç¥</div>
    </div>

    <div id="lobby" class="screen active">
        <div style="padding: 20px;">
            <div style="background:#111; padding:15px; border-radius:12px; border:1px solid #222; display:flex; align-items:center; gap:10px;">
                <img id="u-p" src="" class="u-img" style="width:40px; height:40px;">
                <div id="u-n">–ì—Ä–∞–≤–µ—Ü—å</div>
            </div>
            <div onclick="toGame()" style="background:#111; margin-top:20px; padding:30px; border-radius:15px; text-align:center; border:1px solid #222;">
                <div style="font-size:40px;">üöÄ</div>
                <h3>–ì–†–ê–¢–ò</h3>
            </div>
        </div>
    </div>

    <div id="game" class="screen">
        <div class="history" id="hs-box">
            <div id="live-x" class="hs-item" style="color:var(--blue); border-color:var(--blue);">0.0s</div>
        </div>
        <div class="viewport">
            <video id="rocket" playsinline muted loop>
                <source src="https://files.catbox.moe/d13y9l.mp4" type="video/mp4">
            </video>
        </div>
        <div class="controls">
            <input type="number" id="bet-in" value="100">
            <button id="btn-act" class="btn" style="background:var(--blue);" onclick="handleAction()">–°–¢–ê–í–ö–ê</button>
        </div>
        <div class="bets-list" id="my-bets-container">
            </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const user = tg.initDataUnsafe?.user || { first_name: "User", id: "0" };
        const name = user.username ? "@" + user.username : user.first_name;
        const photo = user.photo_url || `https://ui-avatars.com/api/?name=${name}&background=222&color=fff`;

        document.getElementById('u-n').innerText = name;
        document.getElementById('u-p').src = photo;

        let bal = parseFloat(localStorage.getItem('gift_bal')) || 500.00;
        let bet = 0;
        let won = false;
        let lastId = -1;
        let hist = JSON.parse(localStorage.getItem('gift_hist')) || [];

        function save() {
            document.getElementById('bal-val').innerText = bal.toFixed(2);
            localStorage.setItem('gift_bal', bal);
        }

        function toGame() {
            document.getElementById('lobby').classList.remove('active');
            document.getElementById('game').classList.add('active');
            drawHist();
        }

        function drawHist() {
            const box = document.getElementById('hs-box');
            while (box.children.length > 1) box.removeChild(box.lastChild);
            hist.forEach(v => {
                const d = document.createElement('div');
                d.className = 'hs-item';
                d.style.color = '#888';
                d.innerText = v.toFixed(2) + 'x';
                box.appendChild(d);
            });
        }

        function handleAction() {
            const ms = Date.now() % 20000;
            const amt = parseFloat(document.getElementById('bet-in').value);
            const btn = document.getElementById('btn-act');

            if (ms < 6000 && bet === 0) {
                if (amt > bal || amt <= 0) return;
                bal -= amt; bet = amt; won = false; save();
                
                // –°–¢–ê–í–ö–ê –ó–ê–í–ñ–î–ò –í–ì–û–†–£
                const container = document.getElementById('my-bets-container');
                container.innerHTML = `
                    <div class="bet-item">
                        <div class="u-info"><img src="${photo}" class="u-img"><span>${name}</span></div>
                        <span id="cur-bet-x" style="font-weight:bold;">${amt} ‚Ç¥</span>
                    </div>`;
                
                btn.innerText = "–ü–†–ò–ô–ù–Ø–¢–û";
                btn.style.background = "#222";
            } 
            else if (ms >= 6000 && bet > 0 && !won) {
                const x = 1 + ((ms - 6000) / 1000) * 0.15;
                const crash = 1.1 + ((Math.floor(Date.now() / 20000) * 157) % 40) / 10;
                
                if (x < crash) {
                    let win = bet * x;
                    bal += win; won = true; bet = 0; save();
                    btn.innerText = `+${win.toFixed(0)} ‚Ç¥`;
                    btn.style.background = "var(--green)"; btn.style.color = "#000";
                    document.getElementById('cur-bet-x').innerHTML = `<span style="color:var(--green)">+${win.toFixed(0)} ‚Ç¥</span>`;
                }
            }
        }

        function loop() {
            const now = Date.now();
            const ms = now % 20000;
            const rId = Math.floor(now / 20000);
            const btn = document.getElementById('btn-act');
            const rocket = document.getElementById('rocket');
            const live = document.getElementById('live-x');

            if (rId !== lastId) {
                if (lastId !== -1) {
                    const c = 1.1 + ((lastId * 157) % 40) / 10;
                    hist.unshift(c); if (hist.length > 15) hist.pop();
                    localStorage.setItem('gift_hist', JSON.stringify(hist));
                    drawHist();
                }
                lastId = rId;
                if (!won) bet = 0;
                document.getElementById('my-bets-container').innerHTML = ""; 
            }

            const crashX = 1.1 + ((rId * 157) % 40) / 10;
            const crashMs = (crashX - 1) / 0.15 * 1000;

            if (ms < 6000) {
                live.innerText = ((6000 - ms) / 1000).toFixed(1) + "s";
                live.style.color = "var(--blue)";
                rocket.style.transform = "scale(0)"; rocket.pause();
                if (bet === 0) { btn.innerText = "–°–¢–ê–í–ö–ê"; btn.style.background = "var(--blue)"; btn.style.color="#fff"; }
            } else if (ms < 6000 + crashMs) {
                const curX = (1 + ((ms - 6000) / 1000) * 0.15).toFixed(2);
                live.innerText = curX + "x"; live.style.color = "var(--green)";
                rocket.style.transform = "scale(1)"; rocket.play();
                if (bet > 0 && !won) {
                    btn.innerText = "–ó–ê–ë–†–ê–¢–ò " + (bet * curX).toFixed(0);
                    btn.style.background = "var(--green)"; btn.style.color = "#000";
                    if (document.getElementById('cur-bet-x')) document.getElementById('cur-bet-x').innerText = curX + "x";
                }
            } else {
                live.innerText = crashX.toFixed(2) + "x"; live.style.color = "var(--red)";
                rocket.style.transform = "scale(0)";
                if (bet > 0 && !won) {
                    btn.innerText = "BOOM!"; btn.style.background = "var(--red)"; btn.style.color="#fff";
                    bet = 0;
                }
            }
        }

        setInterval(loop, 50);
        save();
    </script>
</body>
</html>
