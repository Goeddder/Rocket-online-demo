<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GiftUp demo by @IllyaGarant üöÄ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --blue: #007aff; --green: #34c759; --red: #ff3b30; --card: #141416; }
        body { background: #000; color: white; font-family: -apple-system, sans-serif; margin: 0; padding: 0; overflow: hidden; height: 100vh; }
        
        .header { padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #1a1a1a; background: #000; height: 50px; position: relative; z-index: 100; box-sizing: border-box; }
        .balance { background: var(--green); color: #000; padding: 5px 12px; border-radius: 20px; font-weight: 800; font-size: 13px; }

        .screen { display: none; height: calc(100vh - 50px); flex-direction: column; position: relative; z-index: 5; }
        .screen.active { display: flex; }

        /* –õ–û–ë–ë–Ü */
        .profile-card { background: var(--card); border-radius: 12px; padding: 15px; border: 1px solid #222; display: flex; align-items: center; gap: 12px; margin: 20px; }
        .avatar-img { width: 45px; height: 45px; border-radius: 50%; background: #222; object-fit: cover; }
        .game-card { background: var(--card); border-radius: 16px; padding: 30px; border: 1px solid #222; text-align: center; cursor: pointer; margin: 0 20px; }
        
        /* –ì–†–ê */
        .game-viewport { flex-grow: 1; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; background: #000; }
        #rocket-v { width: 260px; mix-blend-mode: screen; transform: scale(0); transition: transform 0.4s ease; position: relative; z-index: 5; }

        /* –Ü–°–¢–û–†–Ü–Ø –Ü–ö–°–Ü–í (–ì–û–†–¢–ê–Ñ–¢–¨–°–Ø) */
        .history-section { padding: 8px 10px; background: #000; border-bottom: 1px solid #1a1a1a; display: flex; gap: 8px; overflow-x: auto; scrollbar-width: none; }
        .history-section::-webkit-scrollbar { display: none; }
        .hs-item { background: #000; padding: 5px 12px; border-radius: 4px; font-size: 12px; font-weight: bold; border: 1px solid #222; color: #555; min-width: 45px; text-align: center; }
        .active-tab { border-color: var(--blue); color: var(--blue); }
        .past-item { color: #888; border-color: #222; }

        .back-btn { margin: 10px 15px; background: transparent; border: 1px solid #222; color: #555; padding: 6px 12px; border-radius: 6px; font-size: 11px; cursor: pointer; }

        .controls { padding: 15px; background: #000; border-top: 1px solid #1a1a1a; }
        input { width: 100%; background: #000; border: 1px solid #222; padding: 12px; color: white; border-radius: 8px; font-size: 16px; text-align: center; margin-bottom: 10px; outline: none; box-sizing: border-box; }
        .main-btn { width: 100%; padding: 18px; border-radius: 10px; border: none; font-size: 17px; font-weight: 800; color: white; cursor: pointer; text-transform: uppercase; }

        /* –°–ü–ò–°–û–ö –°–¢–ê–í–û–ö (–ì–û–†–¢–ê–Ñ–¢–¨–°–Ø) */
        .bets-menu { height: 100px; background: #000; border-top: 1px solid #1a1a1a; padding: 10px 15px; overflow-y: auto; scrollbar-width: none; }
        .bet-row { display: flex; justify-content: space-between; align-items: center; font-size: 13px; margin-bottom: 8px; animation: slideUp 0.2s ease; }
        @keyframes slideUp { from { transform: translateY(5px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .user-info { display: flex; align-items: center; gap: 8px; }
        .mini-avatar { width: 24px; height: 24px; border-radius: 50%; object-fit: cover; background: #222; }
    </style>
</head>
<body>
    <div class="header">
        <div style="font-weight: 900;">GIFTUP</div>
        <div class="balance"><span id="bal-val">500.00</span> ‚Ç¥</div>
    </div>

    <div id="lobby-screen" class="screen active">
        <div class="profile-card">
            <img id="user-photo" src="" class="avatar-img" alt="üë§" onerror="this.src='https://ui-avatars.com/api/?name=User&background=222&color=fff'">
            <div>
                <div id="user-name" style="font-weight: bold; font-size: 15px;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
                <div id="user-id" style="font-size: 10px; color: #444;">ID: 00000000</div>
            </div>
        </div>
        <div class="game-card" onclick="openGame()">
            <div style="font-size: 45px; margin-bottom: 10px;">üöÄ</div>
            <h3 style="margin:0">ROCKET ONLINE</h3>
            <div style="color:var(--green); font-size:11px; margin-top:5px;">‚Ä¢ LIVE</div>
        </div>
    </div>

    <div id="rocket-screen" class="screen">
        <div class="history-section" id="hs-container">
            <div id="live-tab" class="hs-item active-tab">0.0s</div>
        </div>
        <button class="back-btn" onclick="closeGame()">‚Üê –í–ò–ô–¢–ò</button>
        <div class="game-viewport">
            <video id="rocket-v" playsinline muted loop>
                <source src="https://files.catbox.moe/d13y9l.mp4" type="video/mp4">
            </video>
        </div>
        <div class="controls">
            <input type="number" id="bet-amt" value="100">
            <button id="action-btn" class="main-btn" style="background: var(--blue);" onclick="doAction()">–°–¢–ê–í–ö–ê</button>
        </div>
        <div class="bets-menu" id="bet-list">
            </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const user = tg.initDataUnsafe?.user || { first_name: "–ì—Ä–∞–≤–µ—Ü—å", id: "000", photo_url: "" };
        const uName = user.username ? "@" + user.username : user.first_name;
        const uPhoto = user.photo_url || `https://ui-avatars.com/api/?name=${uName}&background=222&color=fff`;

        document.getElementById('user-name').innerText = uName;
        document.getElementById('user-id').innerText = `ID: ${user.id}`;
        document.getElementById('user-photo').src = uPhoto;

        let balance = parseFloat(localStorage.getItem('giftup_bal')) || 500.00;
        let myBet = 0;
        let hasWon = false;
        let lastRoundId = -1;
        let history = JSON.parse(localStorage.getItem('rocket_history')) || [];

        function updateBal() {
            document.getElementById('bal-val').innerText = balance.toFixed(2);
            localStorage.setItem('giftup_bal', balance);
        }

        function openGame() {
            document.getElementById('lobby-screen').classList.remove('active');
            document.getElementById('rocket-screen').classList.add('active');
            renderHistory();
        }

        function closeGame() {
            document.getElementById('rocket-screen').classList.remove('active');
            document.getElementById('lobby-screen').classList.add('active');
        }

        function getCrash(rId) { return 1.1 + ((rId * 157) % 40) / 10; }

        function renderHistory() {
            const container = document.getElementById('hs-container');
            while (container.children.length > 1) container.removeChild(container.lastChild);
            history.forEach(val => {
                const item = document.createElement('div');
                item.className = 'hs-item past-item';
                item.innerText = val.toFixed(2) + 'x';
                container.appendChild(item);
            });
        }

        function doAction() {
            const ms = Date.now() % 20000;
            const btn = document.getElementById('action-btn');
            const amt = parseFloat(document.getElementById('bet-amt').value);

            if (ms < 6000 && myBet === 0) {
                if (amt > balance || amt <= 0) return;
                balance -= amt; myBet = amt; hasWon = false;
                updateBal();
                
                // –¢–≤–æ—è —Å—Ç–∞–≤–∫–∞ –∑–∞–≤–∂–¥–∏ –ø–µ—Ä—à–∞
                const betList = document.getElementById('bet-list');
                betList.innerHTML = `
                    <div class="bet-row">
                        <div class="user-info">
                            <img src="${uPhoto}" class="mini-avatar">
                            <span style="color:var(--blue)">${uName}</span>
                        </div>
                        <span id="live-x" style="font-weight:bold;">${amt} ‚Ç¥</span>
                    </div>`;
                    
                btn.innerText = "–ü–†–ò–ô–ù–Ø–¢–û"; btn.style.background = "#111";
            } 
            else if (ms >= 6000 && myBet > 0 && !hasWon) {
                const curX = 1 + ((ms - 6000) / 1000) * 0.15;
                if (curX < getCrash(Math.floor(Date.now() / 20000))) {
                    let win = myBet * curX;
                    balance += win; hasWon = true; myBet = 0;
                    updateBal();
                    btn.innerText = `+${win.toFixed(0)} ‚Ç¥`; btn.style.background = "var(--green)";
                    btn.style.color = "#000";
                    const liveX = document.getElementById('live-x');
                    if(liveX) liveX.innerHTML = `<span style="color:var(--green)">+${win.toFixed(0)} ‚Ç¥</span>`;
                }
            }
        }

        function main() {
            const now = Date.now();
            const ms = now % 20000;
            const rId = Math.floor(now / 20000);
            const tab = document.getElementById('live-tab');
            const rocket = document.getElementById('rocket-v');
            const btn = document.getElementById('action-btn');

            if (rId !== lastRoundId) {
                if (lastRoundId !== -1) {
                    history.unshift(getCrash(lastRoundId));
                    if (history.length > 15) history.pop();
                    localStorage.setItem('rocket_history', JSON.stringify(history));
                    renderHistory();
                }
                lastRoundId = rId;
                if (!hasWon) myBet = 0;
                document.getElementById('bet-list').innerHTML = ""; // –û—á–∏—Å—Ç–∫–∞ –Ω–∞ –Ω–æ–≤–∏–π —Ä–∞—É–Ω–¥
            }

            const cX = getCrash(rId);
            const cMs = (cX - 1) / 0.15 * 1000;

            if (ms < 6000) {
                tab.innerText = ((6000 - ms) / 1000).toFixed(1) + "s";
                tab.style.color = "var(--blue)";
                rocket.style.transform = "scale(0)"; rocket.pause();
                if(myBet === 0) { btn.innerText = "–°–¢–ê–í–ö–ê"; btn.style.background = "var(--blue)"; btn.style.color="white"; }
            } else if (ms < 6000 + cMs) {
                const curX = (1 + ((ms - 6000) / 1000) * 0.15).toFixed(2);
                tab.innerText = curX + "x"; tab.style.color = "var(--green)";
                rocket.style.transform = "scale(1)"; rocket.play();
                if(myBet > 0 && !hasWon) {
                    btn.innerText = "–ó–ê–ë–†–ê–¢–ò " + (myBet * curX).toFixed(0);
                    btn.style.background = "var(--green)"; btn.style.color = "#000";
                    const liveX = document.getElementById('live-x');
                    if(liveX) liveX.innerText = curX + "x";
                }
            } else {
                tab.innerText = cX.toFixed(2) + "x"; tab.style.color = "var(--red)";
                rocket.style.transform = "scale(0)";
                if(myBet > 0 && !hasWon) { 
                    btn.innerText = "BOOM!"; btn.style.background = "var(--red)"; btn.style.color="white";
                    const liveX = document.getElementById('live-x');
                    if(liveX) liveX.innerHTML = `<span style="color:var(--red)">CRASH</span>`;
                    myBet = 0; 
                }
            }
        }

        setInterval(main, 50);
        updateBal();
    </script>
</body>
</html>
